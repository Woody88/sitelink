erDiagram
    %% Clerk-managed entities (external)
    USERS ||--o{ ORGANIZATIONS : member_of
    USERS ||--o{ SUBSCRIPTIONS : has

    %% Local D1 database entities
    ORGANIZATIONS ||--o{ PROJECTS : owns
    PROJECTS ||--o{ PLANS : has
    PLANS ||--o{ FILES : points_to
    PROJECTS ||--o{ MEDIA : has

    %% Entity definitions
    USERS {
        string id PK
        string email
        string name
    }

    ORGANIZATIONS {
        string id PK
        string name
        string clerk_organization_id
    }

    SUBSCRIPTIONS {
        string id PK
        string stripe_subscription_id
        string user_id FK
        string plan
        date start_date
        date end_date
    }

    PROJECTS {
        string id PK
        string name
        string description
        string organization_id FK
        date created_at
        date updated_at
    }

    PLANS {
        string id PK
        string project_id FK
        string name
        string description
        string r2_directory_path
        date created_at
        date updated_at
    }

    FILES {
        string id PK
        string plan_id FK
        string r2_file_path
        string file_type
        date uploaded_at
    }

    MEDIA {
        string id PK
        string project_id FK
        string file_path
        string media_type
        date uploaded_at
    }
