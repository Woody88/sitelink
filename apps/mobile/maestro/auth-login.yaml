# Auth Login Flow
# Logs in an existing user
# Ends on the Projects screen
#
# Environment variables:
#   TEST_EMAIL - User's email (default: test@example.com)
#   TEST_PASSWORD - User's password (default: password123)
#
# Prerequisites:
#   - Backend running (bun dev:network)
#   - User must already exist (run auth-signup.yaml first if fresh DB)

appId: com.nessei.sitelink
---
- launchApp:
    clearState: true

# Dev client launcher may appear after clearState - tap dev server if visible
- extendedWaitUntil:
    visible: 'http://localhost:8081'
    timeout: 10000
    optional: true
- tapOn:
    text: 'http://localhost:8081'
    optional: true

# Dismiss dev menu intro popup if it appears
- extendedWaitUntil:
    visible: 'Continue'
    timeout: 15000
    optional: true
- tapOn:
    text: 'Continue'
    optional: true
# Close dev tools menu that opens after tapping Continue
- pressKey: back

# Wait for app to load and show Sign In screen
- extendedWaitUntil:
    visible: 'Sign In'
    timeout: 30000

# Fill login form
- tapOn:
    id: 'email-input'
- inputText: 'test@example.com'
- tapOn:
    id: 'password-input'
- inputText: 'password123'

# Submit login
- hideKeyboard
- tapOn:
    id: 'signin-button'
- waitForAnimationToEnd

# Verify we're on the Projects screen
- extendedWaitUntil:
    visible: 'Projects'
    timeout: 15000
