# Auth Signup Flow
# Registers a new user and skips biometric setup
# Ends on the Projects screen (empty state)
#
# Environment variables:
#   TEST_NAME - User's name (default: Tester)
#   TEST_EMAIL - User's email (default: test@example.com)
#   TEST_PASSWORD - User's password (default: password123)
#
# Prerequisites:
#   - Backend running (bun dev:network)
#   - Clean database state (bun wrangler:state:reset && bash delete_db.sh)

appId: host.exp.exponent
---
- openLink: exp://192.168.2.13:8081
- waitForAnimationToEnd

# Dismiss Expo account login prompt if it appears (tap X at top right)
- runFlow:
    when:
      visible: 'Log in or create an account'
    commands:
      - tapOn:
          point: '91%,7%'
      - waitForAnimationToEnd

# Dismiss Expo developer menu if it appears (tap outside the bottom sheet)
- runFlow:
    when:
      visible: '@sitelink/mobile'
    commands:
      - tapOn:
          point: '93%,56%'
      - waitForAnimationToEnd

# Wait for app to load and show Sign In screen (may take a while for bundle download)
- extendedWaitUntil:
    visible: 'Sign In'
    timeout: 120000

# Dismiss Expo developer menu AGAIN if it appears after app load (tap outside the bottom sheet)
- runFlow:
    when:
      visible: '@sitelink/mobile'
    commands:
      - tapOn:
          point: '93%,56%'
      - waitForAnimationToEnd

# Navigate to signup
- tapOn:
    id: 'signup-link'
- assertVisible: 'Create Account'

# Fill signup form
- tapOn:
    id: 'name-input'
- inputText: 'Tester'
- tapOn:
    id: 'email-input'
- inputText: 'test@example.com'
- tapOn:
    id: 'organization-input'
- inputText: 'Test Organization'
- tapOn:
    id: 'password-input'
- inputText: 'password123'

# Submit signup
- tapOn:
    id: 'signup-button'
- waitForAnimationToEnd

# Handle biometric setup (skip it)
- extendedWaitUntil:
    visible:
      text: 'Enable Fingerprint?'
    timeout: 10000
    optional: true
- tapOn:
    id: 'skip-biometric-button'
    optional: true
- waitForAnimationToEnd

# Verify we're on the Projects screen
- extendedWaitUntil:
    visible: 'Projects'
    timeout: 10000
- assertVisible: 'No Projects Found'
